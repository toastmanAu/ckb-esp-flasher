<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CKB ESP32 Flasher</title>
  <script type="module" src="https://unpkg.com/esp-web-tools@10/dist/web/install-button.js"></script>
  <style>
    :root {
      --bg:      #0d0d0d;
      --panel:   #161616;
      --border:  #2a2a2a;
      --accent:  #f0a500;
      --accent2: #00c896;
      --text:    #e8e8e8;
      --dim:     #888;
      --warn:    #e05a00;
      --radius:  10px;
      --font:    'Segoe UI', system-ui, sans-serif;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--font);
      min-height: 100vh;
    }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    header {
      background: var(--panel);
      border-bottom: 1px solid var(--border);
      padding: 18px 32px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    header .logo {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: -0.5px;
    }
    header .logo span { color: var(--accent); }
    header nav {
      margin-left: auto;
      display: flex;
      gap: 8px;
    }
    header nav a {
      color: var(--dim);
      text-decoration: none;
      padding: 6px 14px;
      border-radius: 6px;
      font-size: 14px;
      transition: background 0.15s, color 0.15s;
    }
    header nav a:hover, header nav a.active {
      background: var(--border);
      color: var(--text);
    }
    header nav a.active { color: var(--accent); }

    /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
    .hero {
      text-align: center;
      padding: 56px 24px 32px;
    }
    .hero h1 {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 10px;
    }
    .hero h1 span { color: var(--accent); }
    .hero p {
      color: var(--dim);
      font-size: 16px;
      max-width: 520px;
      margin: 0 auto;
      line-height: 1.6;
    }

    /* ‚îÄ‚îÄ BOARD GRID ‚îÄ‚îÄ */
    .boards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px;
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 24px 60px;
    }

    .board-card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      transition: border-color 0.2s;
    }
    .board-card:hover { border-color: var(--accent); }

    .board-card .board-img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      background: #1a1a1a;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--border);
      font-size: 13px;
    }
    .board-card .board-img img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }

    .board-body { padding: 20px; }
    .board-body h2 { font-size: 17px; margin-bottom: 4px; }
    .board-body .chip-badge {
      display: inline-block;
      background: #1e2a1e;
      color: var(--accent2);
      border: 1px solid #2a4a2a;
      border-radius: 4px;
      font-size: 11px;
      padding: 2px 8px;
      margin-bottom: 10px;
      font-family: monospace;
    }
    .board-body p {
      color: var(--dim);
      font-size: 13px;
      line-height: 1.6;
      margin-bottom: 16px;
    }

    .board-body .meta {
      display: flex;
      gap: 12px;
      font-size: 12px;
      color: var(--dim);
      margin-bottom: 16px;
    }
    .board-body .meta a {
      color: var(--accent);
      text-decoration: none;
    }
    .board-body .meta a:hover { text-decoration: underline; }

    .board-body .version {
      font-family: monospace;
      font-size: 12px;
      color: var(--dim);
      margin-bottom: 16px;
    }
    .board-body .version span { color: var(--accent2); }

    /* ESP Web Tools install button */
    esp-web-install-button {
      width: 100%;
    }
    esp-web-install-button::part(button) {
      background: var(--accent);
      color: #000;
      border: none;
      border-radius: 7px;
      padding: 11px 0;
      width: 100%;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.15s;
    }
    esp-web-install-button::part(button):hover { opacity: 0.88; }
    esp-web-install-button[install-unsupported]::part(button) {
      background: var(--border);
      color: var(--dim);
      cursor: not-allowed;
    }

    .browser-note {
      text-align: center;
      color: var(--warn);
      font-size: 13px;
      margin: -16px 0 32px;
      padding: 0 24px;
    }
    .browser-note a { color: var(--warn); }

    /* ‚îÄ‚îÄ COMING SOON CARD ‚îÄ‚îÄ */
    .board-card.soon { opacity: 0.5; pointer-events: none; }
    .board-card.soon .soon-badge {
      display: inline-block;
      background: #1a1a2a;
      color: var(--dim);
      border: 1px solid var(--border);
      border-radius: 4px;
      font-size: 11px;
      padding: 2px 8px;
      margin-bottom: 10px;
    }

    /* ‚îÄ‚îÄ HOW IT WORKS ‚îÄ‚îÄ */
    .how {
      background: var(--panel);
      border-top: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
      padding: 40px 24px;
      margin-bottom: 48px;
    }
    .how-inner {
      max-width: 800px;
      margin: 0 auto;
    }
    .how h2 {
      font-size: 20px;
      margin-bottom: 24px;
      color: var(--accent);
    }
    .steps {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 16px;
    }
    .step {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
    }
    .step .num {
      font-size: 28px;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 6px;
    }
    .step p { color: var(--dim); font-size: 13px; line-height: 1.5; }

    /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
    footer {
      text-align: center;
      padding: 24px;
      color: var(--dim);
      font-size: 13px;
      border-top: 1px solid var(--border);
    }
    footer a { color: var(--accent); text-decoration: none; }
  </style>
</head>
<body>

<header>
  <div class="logo"><span>CKB</span> ESP Flasher</div>
  <nav>
    <a href="index.html" class="active">Flash</a>
    <a href="theme.html">Theme Builder</a>
  </nav>
</header>

<div class="hero">
  <h1>Flash your <span>CKB</span> Node Client</h1>
  <p>Plug in your ESP32, select your board below, and click Flash. No drivers, no IDE, no fuss. Runs entirely in your browser via Web Serial.</p>
  <p style="color:#00c896;font-size:14px;margin-top:10px;">üì± Works on Android too ‚Äî Chrome + USB OTG adapter, no PC needed.</p>
</div>

<!-- Browser compatibility warning -->
<script>
  if (!navigator.serial) {
    document.write('<p class="browser-note">‚ö†Ô∏è Web Serial requires <strong>Chrome or Edge</strong> on desktop, or <strong>Chrome on Android</strong> with a USB OTG adapter. <a href="https://caniuse.com/web-serial" target="_blank">Safari not supported.</a></p>');
  }
</script>

<!-- HOW IT WORKS -->
<div class="how">
  <div class="how-inner">
    <h2>How it works</h2>
    <div class="steps">
      <div class="step"><div class="num">1</div><p>Plug your ESP32 into your computer via USB ‚Äî or use a <strong>USB OTG adapter on Android</strong></p></div>
      <div class="step"><div class="num">2</div><p>Select your board below and click <strong>Flash</strong></p></div>
      <div class="step"><div class="num">3</div><p>Select the USB port when prompted by the browser</p></div>
      <div class="step"><div class="num">4</div><p>Wait ~30 seconds ‚Äî done! Device reboots automatically</p></div>
    </div>
  </div>
</div>


<!-- CONFIGURE SECTION -->
<div class="how" style="margin-top:0; margin-bottom:0; border-top:none;">
  <div class="how-inner">
    <h2>‚öôÔ∏è Configure after flashing</h2>
    <p style="color:var(--dim);font-size:14px;line-height:1.7;margin-bottom:20px;">
      The firmware has a built-in config mode. After flashing, you can update your WiFi credentials,
      point it at a different CKB node, or change the accent colour ‚Äî all without reflashing.
      Just plug in via USB and use the <a href="theme.html" style="color:var(--accent)">Theme Builder</a>.
    </p>
    <div class="steps">
      <div class="step">
        <div class="num">1</div>
        <p>Plug the device into your PC via USB and open the <a href="theme.html" style="color:var(--accent)">Theme Builder</a></p>
      </div>
      <div class="step">
        <div class="num">2</div>
        <p>Set your WiFi, node URL (local <em>or</em> public ‚Äî e.g. <code>https://mainnet.ckbapp.dev</code>) and accent colour</p>
      </div>
      <div class="step">
        <div class="num">3</div>
        <p>Click <strong>Connect &amp; Send</strong> ‚Äî the browser opens a serial connection and sends your config</p>
      </div>
      <div class="step">
        <div class="num">4</div>
        <p>Device saves settings to flash and reboots. No reflashing needed ‚Äî changes persist across power cycles</p>
      </div>
    </div>
    <p style="color:var(--dim);font-size:12px;margin-top:16px;">
      ‚ö° How it works: on every boot the firmware listens on USB serial for 3 seconds.
      If the browser connects and sends <code style="color:var(--accent2)">CKBCFG</code>, the device enters config mode,
      receives a small JSON blob, writes it to NVS (non-volatile storage), then reboots with the new settings applied.
      Default firmware values are used as fallback if no config has been sent yet.
    </p>
  </div>
</div>

<!-- BOARD CARDS -->
<div class="boards">

  <!-- Guition ESP32-S3 4848S040 -->
  <div class="board-card">
    <div class="board-img">
      <img src="assets/guition4848.jpg" alt="Guition ESP32-S3 4848S040"
           onerror="this.parentElement.textContent='üì∑ Board image coming soon'">
    </div>
    <div class="board-body">
      <h2>CKB Node Monitor</h2>
      <div class="chip-badge">ESP32-S3 ¬∑ Guition 4848S040</div>
      <p>480√ó480 RGB parallel display. Shows live block height, peers, mempool, epoch progress and node info. Polls your local CKB node via WiFi.</p>
      <div class="meta">
        <span>Display: ST7701S 480√ó480</span>
        <a href="https://github.com/toastmanAu/kernel-workspace/tree/target/esp32s3-86box/projects/ckb-lora-client/esp32s3_guition4848_ckb_client" target="_blank">Source ‚Üó</a>
      </div>
      <div class="version">Latest: <span id="ver-guition4848">loading...</span></div>
      <esp-web-install-button manifest="firmware/guition4848/manifest.json">
        <span slot="unsupported">Use Chrome or Edge to flash</span>
      </esp-web-install-button>
    </div>
  </div>

  <!-- T-Impulse LoRa (coming soon) -->
  <div class="board-card soon">
    <div class="board-img">
      <img src="assets/timpulse.jpg" alt="T-Impulse"
           onerror="this.parentElement.textContent='üì∑ Board image coming soon'">
    </div>
    <div class="board-body">
      <h2>CKB LoRa Client</h2>
      <div class="soon-badge">Coming soon</div>
      <p>T-Impulse with SSD1306 OLED. Block height and node stats over LoRa ‚Äî no WiFi required.</p>
      <div class="meta">
        <span>Display: SSD1306 128√ó64</span>
      </div>
    </div>
  </div>

  <!-- ESP32-P4 W5500 (coming soon) -->
  <div class="board-card soon">
    <div class="board-img">
      <img src="assets/esp32p4.jpg" alt="ESP32-P4"
           onerror="this.parentElement.textContent='üì∑ Board image coming soon'">
    </div>
    <div class="board-body">
      <h2>CKB Light Client</h2>
      <div class="soon-badge">Coming soon</div>
      <p>ESP32-P4 + W5500 Ethernet. Full CKB light client with header verification ‚Äî no trusted node required.</p>
      <div class="meta">
        <span>Network: W5500 SPI Ethernet</span>
      </div>
    </div>
  </div>

</div>

<footer>
  Built by <a href="https://github.com/toastmanAu" target="_blank">toastmanAu</a> ¬∑
  Firmware on <a href="https://github.com/toastmanAu/kernel-workspace" target="_blank">GitHub</a> ¬∑
  <a href="https://www.nervos.org/" target="_blank">Nervos CKB</a>
</footer>

<script>
  // Fetch latest firmware version from manifest
  fetch('firmware/guition4848/manifest.json')
    .then(r => r.json())
    .then(m => {
      document.getElementById('ver-guition4848').textContent = m.version || 'unknown';
    })
    .catch(() => {
      document.getElementById('ver-guition4848').textContent = 'see GitHub';
    });
</script>

</body>
</html>
